## Database Integration
We are using in memory H2 database.

## Database Initialization

We can use basic SQL scripts to initialize the database. In order to demonstrate this, let's add a `data.sql` file under `src/main/resources` directory:

```aidl
insert into organization (name) values ('Test1');
insert into organization (name) values ('Test2');
```

Spring Boot will automatically pick up this file and run it against an embedded in-memory database, such as our configured H2 instance. This is a good way to seed the database for testing or initialization purposes.

We can disable this default behavior by setting the `spring.sql.init.mode` property to never. 

Additionally, multiple SQL files can also be configured to load the initial data.

## Database Initialization using multiple SQL files

The configuration for initial data and Spring JDBC support is very similar to Hibernate. We have to use the spring.sql.init.data-locations property:

    spring.sql.init.data-locations=import_active_users.sql,import_inactive_users.sql

Setting the value as above gives the same results as in the Hibernate support. However, a significant advantage of this solution is the possibility to define value using an Ant-style pattern:
```aidl
spring.sql.init.data-locations=import_*_users.sql
```

The above value tells the Spring to search for all files with a name that matches import_*_users.sql pattern and import data which is inside.

This property was introduced in Spring Boot 2.5.0; in earlier versions of Spring Boot, we need to use the `spring.datasource.data` property.

## Hibernate Support
If you are using Hibernate than do the following.

We can define files which contain sample data to load with a property spring.jpa.properties.hibernate.hbm2ddl.import_files. It can be set in the application.properties file inside the test resources folder.

This is in a case we want to load sample data just for JUnit tests. The value has to be a comma-separated list of files to import:We can define files which contain sample data to load with a property spring.jpa.properties.hibernate.hbm2ddl.import_files. It can be set in the application.properties file inside the test resources folder.

This is in a case we want to load sample data just for JUnit tests. The value has to be a comma-separated list of files to import:

    spring.jpa.properties.hibernate.hbm2ddl.import_files=import_active_users.sql,import_inactive_users.sql

This configuration will load sample data from two files: import_active_users.sql and import_inactive_users.sql. Important to mention here is that we have to use prefix spring.jpa.properties to pass values (JPA configuration) to the EntityManagerFactory.

If we still want to have both Hibernate automatic schema generation in conjugation with script-based schema creation and data population, we'll have to use:
`spring.jpa.defer-datasource-initialization=true`

This will ensure, that after Hibernate schema creation is performed then additionally schema.sql is read for any additional schema changes and data.sql is executed to populate the database.

## Hibernate and data.sql
By default, the data.sql script executes before Hibernate initialization. This aligns the script-based initialization with other database migration tools such as Flyway and Liquibase. As we're recreating the schema generated by Hibernate each time, we need to set an additional property:

`spring.jpa.defer-datasource-initialization=true`

This modifies the default Spring Boot behavior and populates the data after the schema is generated by Hibernate. Furthermore, we can also use a schema.sql script to build upon the Hibernate-generated schema prior to the population with data.sql. However, this mixing of different schema-generation mechanisms is not recommended.

## Database Tables with Uppercase
H2 was creating the tables with UPPERCASE names then behaving case-sensitive, even though in all scripts (including in the creation ones) i used lowercase.
Solved by adding ;DATABASE_TO_UPPER=false to the connection URL.
`spring.h2.datasource.url: jdbc:h2:mem:mydb;DATABASE_TO_UPPER=false`

## References

1. [Quick Guide on Loading Initial Data with Spring Boot](https://www.baeldung.com/spring-boot-data-sql-and-schema-sql)